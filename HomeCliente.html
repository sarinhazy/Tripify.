<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tripify - Home</title>
  <link rel="stylesheet" href="home.css">
  <style>
    /* Estilo do bot√£o e barra de busca */
    .search-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 20px;
      align-items: center;
    }

    #searchInput, #categorySelect {
      padding: 10px;
      font-size: 1em;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    #showAllBtn {
      padding: 10px 20px;
      background-color: #db760b;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    #showAllBtn:hover {
      background-color: #e48919;
    }

    #userCityIndicator {
      font-weight: bold;
      font-size: 0.9em;
      color: #fffefe;
    }

    .share-btn {
      padding: 8px 16px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }

    .share-btn:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <div class="navbar">
    <h1 data-i18n="logo">Tripify</h1>
    <ul>
      <li><a href="Cadastro.html" data-i18n="navTrips">In√≠cio</a></li>
      <li><a href="HomeCliente.html" data-i18n="navTrips">Viagens</a></li>
      <li><a href="#" data-i18n="navManage">Gerenciar</a></li>
      <li><a href="#" data-i18n="navReview">Avalia√ß√£o</a></li>
      <li><a href="#" data-i18n="navAbout">Sobre n√≥s</a></li>
    </ul>
    <select id="languageSelect">
      <option value="pt">üáßüá∑ PT</option>
      <option value="en">üá∫üá∏ EN</option>
      <option value="es">üá™üá∏ ES</option>
    </select>
  </div>

  <!-- Barra de busca -->
  <div class="search-bar">
    <input type="text" id="searchInput" data-i18n-placeholder="searchPlaceholder" placeholder="Buscar excurs√µes...">
    <select id="categorySelect">
      <option value="all" data-i18n="allCategories">Todas as categorias</option>
      <option value="aventura" data-i18n="adventure">Aventura</option>
      <option value="cultural" data-i18n="cultural">Cultural</option>
      <option value="gastronomica" data-i18n="gastronomic">Gastron√¥mica</option>
    </select>
    <select id="priceFilter">
      <option value="all">Todos os pre√ßos</option>
      <option value="0-200">At√© R$ 200</option>
      <option value="200-400">R$ 200 - R$ 400</option>
      <option value="400+">Acima de R$ 400</option>
    </select>
    <select id="durationFilter">
      <option value="all">Todas as dura√ß√µes</option>
      <option value="0-6">At√© 6h</option>
      <option value="6-12">6h - 12h</option>
      <option value="12+">Mais de 12h</option>
    </select>
    <select id="distanceFilter">
      <option value="all">Todas as dist√¢ncias</option>
      <option value="0-50">At√© 50km</option>
      <option value="50-100">50km - 100km</option>
      <option value="100+">Mais de 100km</option>
    </select>
    <button id="showAllBtn">Mostrar todas as cidades</button>
    <span id="userCityIndicator"></span>
  </div>

  <!-- Excurs√µes -->
  <div class="excursions" id="excursionList"></div>

  <script>
    const apiKey = "25f3f18472d9c74677f8e4b5fc74ae35"; 

    const excursions = [
      { id: 1, name: { pt: "Trilha na Serra", en: "Mountain Trail" }, company: "AventuraX", image: "https://picsum.photos/id/1018/600/400", vagas: 15, location: "S√£o Paulo", category: "aventura", price: 150, duration: 8, distance: 50 },
      { id: 2, name: { pt: "Tour Hist√≥rico", en: "Historic Tour" }, company: "CulturaBrasil", image: "https://picsum.photos/id/1015/600/400", vagas: 10, location: "Rio de Janeiro", category: "cultural", price: 200, duration: 6, distance: 120 },
      { id: 3, name: { pt: "Rota Gastron√¥mica", en: "Food Route" }, company: "SaborViagens", image: "https://picsum.photos/id/1025/600/400", vagas: 20, location: "Belo Horizonte", category: "gastronomica", price: 300, duration: 12, distance: 80 }
    ];

    const excursionList = document.getElementById("excursionList");
    const languageSelect = document.getElementById("languageSelect");
    const showAllBtn = document.getElementById("showAllBtn");
    const userCityIndicator = document.getElementById("userCityIndicator");
    let currentLang = "pt";
    let userCity = "";
    let showAllCities = false;

    // Obter localiza√ß√£o do usu√°rio
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async (position) => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        try {
          const res = await fetch(`https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${apiKey}`);
          const data = await res.json();
          if(data[0] && data[0].name){
            userCity = data[0].name;
            userCityIndicator.textContent = `Cidade detectada: ${userCity}`;
            renderExcursions();
          }
        } catch (err) {
          console.log("Erro ao obter cidade do usu√°rio:", err);
        }
      }, (err) => {
        console.log("Geolocaliza√ß√£o n√£o permitida ou n√£o dispon√≠vel", err);
      });
    }

    // Renderizar excurs√µes
    async function renderExcursions(filter = "", searchValue = "") {
      const priceFilter = document.getElementById("priceFilter").value;
      const durationFilter = document.getElementById("durationFilter").value;
      const distanceFilter = document.getElementById("distanceFilter").value;
      excursionList.innerHTML = "";
      for (let excursion of excursions) {
        // Filtrar categoria
        if (filter && filter !== "all" && excursion.category !== filter) continue;

        // Filtrar por busca
        if (searchValue && !excursion.name[currentLang].toLowerCase().includes(searchValue.toLowerCase())) continue;

        // Filtrar por pre√ßo
        if (priceFilter !== "all") {
          if (priceFilter === "0-200" && excursion.price > 200) continue;
          if (priceFilter === "200-400" && (excursion.price < 200 || excursion.price > 400)) continue;
          if (priceFilter === "400+" && excursion.price < 400) continue;
        }

        // Filtrar por dura√ß√£o
        if (durationFilter !== "all") {
          if (durationFilter === "0-6" && excursion.duration > 6) continue;
          if (durationFilter === "6-12" && (excursion.duration < 6 || excursion.duration > 12)) continue;
          if (durationFilter === "12+" && excursion.duration < 12) continue;
        }

        // Filtrar por dist√¢ncia
        if (distanceFilter !== "all") {
          if (distanceFilter === "0-50" && excursion.distance > 50) continue;
          if (distanceFilter === "50-100" && (excursion.distance < 50 || excursion.distance > 100)) continue;
          if (distanceFilter === "100+" && excursion.distance < 100) continue;
        }

        // Filtrar por localiza√ß√£o do usu√°rio
        if (!showAllCities && userCity && excursion.location.toLowerCase() !== userCity.toLowerCase()) continue;

        // Clima
        let weatherText = "Carregando previs√£o...";
        try {
          const response = await fetch(
            `https://api.openweathermap.org/data/2.5/weather?q=${excursion.location}&appid=${apiKey}&lang=${currentLang}&units=metric`
          );
          const data = await response.json();
          if (data.weather) {
            weatherText = `${data.weather[0].description}, ${data.main.temp}¬∞C`;
          } else {
            weatherText = "N√£o dispon√≠vel";
          }
        } catch {
          weatherText = "Erro ao carregar";
        }

        const card = document.createElement("div");
        card.className = "excursion-card";
        card.innerHTML = `
          <img src="${excursion.image}" alt="${excursion.name[currentLang]}">
          <div class="excursion-info">
            <h2>${excursion.name[currentLang]}</h2>
            <p><strong>Empresa:</strong> ${excursion.company}</p>
            <p><strong>Pre√ßo:</strong> R$ ${excursion.price}</p>
            <p><strong>Dura√ß√£o:</strong> ${excursion.duration}h</p>
            <p><strong>Dist√¢ncia:</strong> ${excursion.distance}km</p>
            <p><strong>Vagas:</strong> ${excursion.vagas}</p>
            <p class="weather"><strong>Clima:</strong> ${weatherText}</p>
            <p><strong>Local:</strong> ${excursion.location}</p>
            <button onclick="shareExcursion(${excursion.id}, '${excursion.name[currentLang]}')" class="share-btn">Convidar Amigos</button>
          </div>
        `;
        excursionList.appendChild(card);
      }
    }

    // Buscar excurs√µes
    document.getElementById("searchInput").addEventListener("input", (e) => {
      const value = e.target.value;
      renderExcursions(document.getElementById("categorySelect").value, value);
    });

    // Filtros
    document.getElementById("categorySelect").addEventListener("change", () => renderExcursions(document.getElementById("categorySelect").value, document.getElementById("searchInput").value));
    document.getElementById("priceFilter").addEventListener("change", () => renderExcursions(document.getElementById("categorySelect").value, document.getElementById("searchInput").value));
    document.getElementById("durationFilter").addEventListener("change", () => renderExcursions(document.getElementById("categorySelect").value, document.getElementById("searchInput").value));
    document.getElementById("distanceFilter").addEventListener("change", () => renderExcursions(document.getElementById("categorySelect").value, document.getElementById("searchInput").value));

    // Idioma
    languageSelect.addEventListener("change", (e) => {
      currentLang = e.target.value;
      renderExcursions(document.getElementById("categorySelect").value, document.getElementById("searchInput").value);
    });

    // Bot√£o Mostrar todas as cidades
    showAllBtn.addEventListener("click", () => {
      showAllCities = !showAllCities;
      showAllBtn.textContent = showAllCities ? "Filtrar pela minha cidade" : "Mostrar todas as cidades";
      renderExcursions(document.getElementById("categorySelect").value, document.getElementById("searchInput").value);
    });

    // Fun√ß√£o para compartilhar excurs√£o
    function shareExcursion(excursionId, excursionName) {
      const inviteLink = `${window.location.origin}/convite.html?excursao=${excursionId}`;
      
      if (navigator.share) {
        navigator.share({
          title: `Convite para ${excursionName}`,
          text: `Voc√™ foi convidado para participar da excurs√£o: ${excursionName}`,
          url: inviteLink
        });
      } else {
        navigator.clipboard.writeText(inviteLink).then(() => {
          alert('Link copiado! Compartilhe com seus amigos.');
        });
      }
    }

    renderExcursions();
  </script>
</body>
</html>
