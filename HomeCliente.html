<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tripify - Home</title>
  <link rel="stylesheet" href="home.css">
  <style>
    /* Estilo do botÃ£o e barra de busca */
    .search-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 20px;
      align-items: center;
    }

    #searchInput, #categorySelect {
      padding: 10px;
      font-size: 1em;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    #showAllBtn {
      padding: 10px 20px;
      background-color: #db760b;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    #showAllBtn:hover {
      background-color: #e48919;
    }

    #userCityIndicator {
      font-weight: bold;
      font-size: 0.9em;
      color: #fffefe;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <div class="navbar">
    <h1 data-i18n="logo">Tripify</h1>
    <ul>
      <li><a href="Cadastro.html" data-i18n="navTrips">InÃ­cio</a></li>
      <li><a href="HomeCliente.html" data-i18n="navTrips">Viagens</a></li>
      <li><a href="#" data-i18n="navManage">Gerenciar</a></li>
      <li><a href="#" data-i18n="navReview">AvaliaÃ§Ã£o</a></li>
      <li><a href="#" data-i18n="navAbout">Sobre nÃ³s</a></li>
    </ul>
    <select id="languageSelect">
      <option value="pt">ðŸ‡§ðŸ‡· PT</option>
      <option value="en">ðŸ‡ºðŸ‡¸ EN</option>
      <option value="es">ðŸ‡ªðŸ‡¸ ES</option>
    </select>
  </div>

  <!-- Barra de busca -->
  <div class="search-bar">
    <input type="text" id="searchInput" data-i18n-placeholder="searchPlaceholder" placeholder="Buscar excursÃµes...">
    <select id="categorySelect">
      <option value="all" data-i18n="allCategories">Todas as categorias</option>
      <option value="aventura" data-i18n="adventure">Aventura</option>
      <option value="cultural" data-i18n="cultural">Cultural</option>
      <option value="gastronomica" data-i18n="gastronomic">GastronÃ´mica</option>
    </select>
    <button id="showAllBtn">Mostrar todas as cidades</button>
    <span id="userCityIndicator"></span>
  </div>

  <!-- ExcursÃµes -->
  <div class="excursions" id="excursionList"></div>

  <script>
    const apiKey = "25f3f18472d9c74677f8e4b5fc74ae35"; 

    const excursions = [
      { id: 1, name: { pt: "Trilha na Serra", en: "Mountain Trail" }, company: "AventuraX", image: "https://picsum.photos/id/1018/600/400", vagas: 15, location: "SÃ£o Paulo", category: "aventura" },
      { id: 2, name: { pt: "Tour HistÃ³rico", en: "Historic Tour" }, company: "CulturaBrasil", image: "https://picsum.photos/id/1015/600/400", vagas: 10, location: "Rio de Janeiro", category: "cultural" },
      { id: 3, name: { pt: "Rota GastronÃ´mica", en: "Food Route" }, company: "SaborViagens", image: "https://picsum.photos/id/1025/600/400", vagas: 20, location: "Belo Horizonte", category: "gastronomica" }
    ];

    const excursionList = document.getElementById("excursionList");
    const languageSelect = document.getElementById("languageSelect");
    const showAllBtn = document.getElementById("showAllBtn");
    const userCityIndicator = document.getElementById("userCityIndicator");
    let currentLang = "pt";
    let userCity = "";
    let showAllCities = false;

    // Obter localizaÃ§Ã£o do usuÃ¡rio
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async (position) => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        try {
          const res = await fetch(`https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${apiKey}`);
          const data = await res.json();
          if(data[0] && data[0].name){
            userCity = data[0].name;
            userCityIndicator.textContent = `Cidade detectada: ${userCity}`;
            renderExcursions();
          }
        } catch (err) {
          console.log("Erro ao obter cidade do usuÃ¡rio:", err);
        }
      }, (err) => {
        console.log("GeolocalizaÃ§Ã£o nÃ£o permitida ou nÃ£o disponÃ­vel", err);
      });
    }

    // Renderizar excursÃµes
    async function renderExcursions(filter = "", searchValue = "") {
      excursionList.innerHTML = "";
      for (let excursion of excursions) {
        // Filtrar categoria
        if (filter && filter !== "all" && excursion.category !== filter) continue;

        // Filtrar por busca
        if (searchValue && !excursion.name[currentLang].toLowerCase().includes(searchValue.toLowerCase())) continue;

        // Filtrar por localizaÃ§Ã£o do usuÃ¡rio
        if (!showAllCities && userCity && excursion.location.toLowerCase() !== userCity.toLowerCase()) continue;

        // Clima
        let weatherText = "Carregando previsÃ£o...";
        try {
          const response = await fetch(
            `https://api.openweathermap.org/data/2.5/weather?q=${excursion.location}&appid=${apiKey}&lang=${currentLang}&units=metric`
          );
          const data = await response.json();
          if (data.weather) {
            weatherText = `${data.weather[0].description}, ${data.main.temp}Â°C`;
          } else {
            weatherText = "NÃ£o disponÃ­vel";
          }
        } catch {
          weatherText = "Erro ao carregar";
        }

        const card = document.createElement("div");
        card.className = "excursion-card";
        card.innerHTML = `
          <img src="${excursion.image}" alt="${excursion.name[currentLang]}">
          <div class="excursion-info">
            <h2>${excursion.name[currentLang]}</h2>
            <p><strong>Empresa:</strong> ${excursion.company}</p>
            <p><strong>Vagas:</strong> ${excursion.vagas}</p>
            <p class="weather"><strong>Clima:</strong> ${weatherText}</p>
            <p><strong>Local:</strong> ${excursion.location}</p>
          </div>
        `;
        excursionList.appendChild(card);
      }
    }

    // Buscar excursÃµes
    document.getElementById("searchInput").addEventListener("input", (e) => {
      const value = e.target.value;
      renderExcursions(document.getElementById("categorySelect").value, value);
    });

    // Filtro categoria
    document.getElementById("categorySelect").addEventListener("change", (e) => {
      renderExcursions(e.target.value, document.getElementById("searchInput").value);
    });

    // Idioma
    languageSelect.addEventListener("change", (e) => {
      currentLang = e.target.value;
      renderExcursions(document.getElementById("categorySelect").value, document.getElementById("searchInput").value);
    });

    // BotÃ£o Mostrar todas as cidades
    showAllBtn.addEventListener("click", () => {
      showAllCities = !showAllCities;
      showAllBtn.textContent = showAllCities ? "Filtrar pela minha cidade" : "Mostrar todas as cidades";
      renderExcursions(document.getElementById("categorySelect").value, document.getElementById("searchInput").value);
    });

    renderExcursions();
  </script>
</body>
</html>
